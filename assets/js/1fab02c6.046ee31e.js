"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[834],{8803:(n,e,d)=>{d.r(e),d.d(e,{assets:()=>i,contentTitle:()=>a,default:()=>b,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var t=d(4848),s=d(8453);const o={author:"facsert",pubDatetime:new Date("2023-04-14T15:28:43.000Z"),title:"Mongo Configuration",slug:"Mongo Configuration",featured:!1,draft:!1,tags:["Mongo"],description:"Mongo \u57fa\u672c\u914d\u7f6e"},a=void 0,l={id:"Database/Mongo/mongo-0-base",title:"Mongo Configuration",description:"Mongo \u57fa\u672c\u914d\u7f6e",source:"@site/docs/Database/Mongo/mongo-0-base.md",sourceDirName:"Database/Mongo",slug:"/Database/Mongo/Mongo Configuration",permalink:"/docs/Database/Mongo/Mongo Configuration",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Database/Mongo/mongo-0-base.md",tags:[{inline:!0,label:"Mongo",permalink:"/docs/tags/mongo"}],version:"current",frontMatter:{author:"facsert",pubDatetime:"2023-04-14T15:28:43.000Z",title:"Mongo Configuration",slug:"Mongo Configuration",featured:!1,draft:!1,tags:["Mongo"],description:"Mongo \u57fa\u672c\u914d\u7f6e"},sidebar:"tutorialSidebar",previous:{title:"\u7ec4\u7ec7\u4ee3\u7801",permalink:"/docs/Code/\u7ec4\u7ec7\u4ee3\u7801"},next:{title:"Mysql Configuration",permalink:"/docs/Database/Mysql/Mysql Configuration"}},i={},c=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Mongo \u5b89\u88c5",id:"mongo-\u5b89\u88c5",level:2},{value:"\u6570\u636e\u5e93",id:"\u6570\u636e\u5e93",level:2},{value:"\u96c6\u5408",id:"\u96c6\u5408",level:2},{value:"\u63d2\u5165\u6570\u636e",id:"\u63d2\u5165\u6570\u636e",level:2},{value:"\u67e5\u8be2\u6570\u636e",id:"\u67e5\u8be2\u6570\u636e",level:2},{value:"\u66f4\u65b0\u6570\u636e",id:"\u66f4\u65b0\u6570\u636e",level:2},{value:"\u5220\u9664\u6570\u636e",id:"\u5220\u9664\u6570\u636e",level:2},{value:"\u5907\u4efd\u6062\u590d",id:"\u5907\u4efd\u6062\u590d",level:2}];function r(n){const e={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,t.jsx)(e.h2,{id:"mongo-\u5b89\u88c5",children:"Mongo \u5b89\u88c5"}),"\n",(0,t.jsx)(e.p,{children:"\u901a\u8fc7 docker \u8fd0\u884c mongo \u6570\u636e\u5e93"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:' $ docker pull mongo\n $ docker images\n > REPOSITORY   TAG       IMAGE ID       CREATED       SIZE\n > mongo        latest    32c5c1d795d9   2 weeks ago   644MB\n\n $ docker run -d --restart=always -p 27017:27017 --name mongodb -v /root/Desktop/Mongo:/data/db  mongo\n $ docker ps\n > CONTAINER ID   IMAGE  COMMAND                 CREATED        STATUS         PORTS                                           NAMES\n > b4da33977293   mongo  "docker-entrypoint.s\u2026"  6 seconds ago  Up 5 seconds   0.0.0.0:27017->27017/tcp, :::27017->27017/tcp   mongodb\n'})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u4ee5 mongo \u4e3a\u955c\u50cf, \u521b\u5efa\u5bb9\u5668 mongodb"}),"\n",(0,t.jsx)(e.li,{children:"\u5bb9\u5668\u5185 /data/db \u76ee\u5f55\u6302\u8f7d\u5230\u7cfb\u7edf /root/Desktop/Mongo \u76ee\u5f55\u4e0b"}),"\n",(0,t.jsx)(e.li,{children:"\u7cfb\u7edf\u7aef\u53e3 27017 \u4e0e\u5bb9\u5668\u5185 27017 \u7aef\u53e3\u6620\u5c04"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:" $ docker exec -it mongodb bash\n\n $ mongosh                                       # \u8fdb\u5165 mongo shell, \u65e9\u671f\u7248\u672c\u4f7f\u7528 mongo \u547d\u4ee4\n >\n"})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.a,{href:"https://mongodb.net.cn/manual/reference/method/",children:"Mongo Shell"})}),"\n",(0,t.jsx)(e.h2,{id:"\u6570\u636e\u5e93",children:"\u6570\u636e\u5e93"}),"\n",(0,t.jsx)(e.p,{children:"Mongo \u4e2d\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a\u6570\u636e\u5e93, \u6570\u636e\u5e93\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a\u96c6\u5408(\u7c7b\u4f3c\u4e8e\u8868), \u96c6\u5408\u7528\u4e8e\u5b58\u50a8\u6570\u636e"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"// \u663e\u793a\u6240\u6709\u6570\u636e\u5e93\nshow dbs                                        \nadmin    40.00 KiB\nconfig  108.00 KiB\nlocal    40.00 KiB\n\n// \u521b\u5efa\u6216\u5207\u6362\u6570\u636e\u5e93(\u6570\u636e\u5e93\u6709\u6570\u636e\u624d\u4f1a\u521b\u5efa, show \u547d\u4ee4\u4e0d\u663e\u793a)\nuse person          \nswitched to db redis                            \n\n// \u663e\u793a\u5f53\u524d\u6570\u636e\u5e93\u540d\u79f0\ndb                                              \nperson\n\n// \u6570\u636e\u5e93 test \u7684\u4fe1\u606f\ndb.stats()                                      \n{\n  db: 'person',\n  collections: Long('0'),\n  views: Long('0'),\n  objects: Long('0'),\n  avgObjSize: 0,\n  dataSize: 0,\n  storageSize: 0,\n  indexes: Long('0'),\n  indexSize: 0,\n  totalSize: 0,\n  scaleFactor: Long('1'),\n  fsUsedSize: 0,\n  fsTotalSize: 0,\n  ok: 1\n}\n\n// \u5220\u9664\u6570\u636e\u5e93 person\ndb.dropDatabase()                               \n{ ok: 1, dropped: 'person' }\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u96c6\u5408",children:"\u96c6\u5408"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:'// \u67e5\u770b\u6570\u636e\u5e93\u5185\u7684\u6240\u6709\u96c6\u5408\nshow collections                                \n{ ok: 1 }\n\n// \u521b\u5efa\u96c6\u5408, \u5e76\u914d\u7f6e(\u96c6\u5408\u6709\u6570\u636e\u624d\u4f1a\u521b\u5efa)\ndb.createCollection(name, option)               \ndb.createCollection("studens", { capped : true, size : 5242880, max : 5000 })\n\n// \u67e5\u770b studens \u96c6\u5408\u72b6\u6001\ndb.studens.stats()     \n \n// \u5220\u9664 studens \u96c6\u5408\ndb.studens.drop()                               \n\n// \u96c6\u5408\u7684\u6570\u636e\u6570\u91cf\ndb.students.countDocuments()                    \n'})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"// \u67e5\u770b\u96c6\u5408\u6240\u6709\u7d22\u5f15(\u6392\u5e8f\u65b9\u5f0f, \u5b57\u6bb5\u7ea6\u675f)\ndb.students.getIndexes()\n[\n  { v: 2, key: { _id: 1 }, name: '_id_' },\n]\n\n// \u6dfb\u52a0 name \u5b57\u6bb5\u5347\u5e8f(1 \u5347\u5e8f, -1 \u964d\u5e8f), \u4e14 name \u5b57\u6bb5\u503c\u552f\u4e00\u7ea6\u675f(unique)\ndb.students.createIndex({name: 1}, {unique: true})\ndb.students.getIndexes()\n[\n  { v: 2, key: { _id: 1 }, name: '_id_' },\n  { v: 2, key: { name: 1 }, name: 'name_1', unique: true }\n]\n"})}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{style:{textAlign:"center"},children:"option"}),(0,t.jsx)(e.th,{style:{textAlign:"center"},children:"type"}),(0,t.jsx)(e.th,{style:{textAlign:"left"},children:"description"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{style:{textAlign:"center"},children:(0,t.jsx)(e.code,{children:"capped"})}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"Boolean"}),(0,t.jsx)(e.td,{style:{textAlign:"left"},children:"true: \u96c6\u5408\u542f\u7528 size \u9650\u5236, \u8d85\u8fc7\u90e8\u5206\u81ea\u52a8\u8986\u76d6\u6700\u65e9\u7684\u6761\u76ee\u3002\u542f\u52a8\u8be5\u9009\u9879\u540c\u65f6\u4e5f\u9700\u6307\u5b9a size \u6570\u503c"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{style:{textAlign:"center"},children:(0,t.jsx)(e.code,{children:"size"})}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"number"}),(0,t.jsx)(e.td,{style:{textAlign:"left"},children:"\u8bbe\u5b9a\u96c6\u5408\u6700\u5927\u53ef\u4f7f\u7528\u5b57\u8282\u6570\u3002capped \u4e3a true \u65f6\u8bbe\u7f6e"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{style:{textAlign:"center"},children:(0,t.jsx)(e.code,{children:"max"})}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"number"}),(0,t.jsx)(e.td,{style:{textAlign:"left"},children:"\u8bbe\u7f6e\u96c6\u5408\u80fd\u5bb9\u7eb3\u7684\u6700\u5927\u6587\u6863\u6570\u91cf\u3002Size\u9650\u5236\u4f18\u5148\u4e8e\u6570\u91cf\u9650\u5236\u3002\u6587\u6863\u6570\u91cf\u672a\u5230 max, size \u5230\u8fbe\u9650\u5236\u65f6\u4e5f\u4f1a\u89e6\u53d1\u6587\u6863\u8986\u76d6"})]})]})]}),"\n",(0,t.jsx)(e.h2,{id:"\u63d2\u5165\u6570\u636e",children:"\u63d2\u5165\u6570\u636e"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"insertOne"}),"\n",(0,t.jsx)(e.li,{children:"insertMany"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:'// \u63d2\u5165\u5355\u4e2a\u6570\u636e\ndb.student.insertOne({name: "John", age: 19})   \n{\n  acknowledged: true,\n  insertedId: ObjectId(\'65d1fe9776bc4fe476eabd1a\')\n}\n\n// \u63d2\u5165\u591a\u4e2a\u6570\u636e\ndb.coll.insertMany([                             \n  { name: "lily"}, \n  { name: "Alen", hobby: "swim"}\n])\n'})}),"\n",(0,t.jsx)(e.h2,{id:"\u67e5\u8be2\u6570\u636e",children:"\u67e5\u8be2\u6570\u636e"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"findOne"}),"\n",(0,t.jsx)(e.li,{children:"find"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"// \u67e5\u8be2\u5339\u914d\u7684\u7b2c\u4e00\u4e2a\u6570\u636e(\u8fd4\u56de\u5339\u914d\u7684\u7b2c\u4e00\u4e2a\u6570\u636e)\ndb.students.findOne({name: 'lily'})              \n{ _id: ObjectId('65d200a776bc4fe476eabd1e'), name: 'lily' }\n\n// \u67e5\u8be2\u6240\u6709\u5339\u914d\u7684\u6570\u636e\ndb.students.find({})                         \n[\n  { _id: ObjectId('65d1ff0e76bc4fe476eabd1b'), name: 'John', age: 19 },\n  { _id: ObjectId('65d200a776bc4fe476eabd1e'), name: 'lily' },\n  {\n    _id: ObjectId('65d200a776bc4fe476eabd1f'),\n    name: 'Alen',\n    hobby: 'swim'\n  }\n]\n\n// \u6570\u636e\u8303\u56f4\u67e5\u8be2($gt $gte $lt $lte $ne $in)\ndb.students.find({age: {$gt: 15}})               \n[\n  { _id: ObjectId('65d1ff0e76bc4fe476eabd1b'), name: 'John', age: 19 }\n]\n\n// \u5c5e\u6027\u5b58\u5728\u67e5\u8be2\ndb.students.findOne({hobby: {$exists: true}})    \n{\n  _id: ObjectId('65d200a776bc4fe476eabd1f'),\n  name: 'Alen',\n  hobby: 'swim'\n}\n\n// \u503c\u7684\u6b63\u5219\u5339\u914d\u67e5\u8be2\ndb.students.find({name: {$regex:'lily|John'}})   \n[\n  { _id: ObjectId('65d1ff0e76bc4fe476eabd1b'), name: 'John', age: 19 },\n  { _id: ObjectId('65d200a776bc4fe476eabd1e'), name: 'lily' }\n]\n\n// \u903b\u8f91\u6216\u67e5\u8be2\ndb.students.find({$or: [{name: 'lily'}, {name: 'Alen'}]})\n[\n  { _id: ObjectId('65d200a776bc4fe476eabd1e'), name: 'lily' },\n  {\n    _id: ObjectId('65d200a776bc4fe476eabd1f'),\n    name: 'Alen',\n    hobby: 'swim'\n  }\n]\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u66f4\u65b0\u6570\u636e",children:"\u66f4\u65b0\u6570\u636e"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"updateOne"}),"\n",(0,t.jsx)(e.li,{children:"updateMany"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.code,{children:"db.coll.updateMany(filter, set)"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"// \u66f4\u65b0\u5355\u4e2a\u6570\u636e\ndb.students.updateOne({name: 'lily'}, {$set: {\"age\": 18} })\ndb.students.findOne({name: 'lily'})\n{ _id: ObjectId('65d200a776bc4fe476eabd1e'), name: 'lily', age: 18 }\n\n// \u66f4\u65b0\u591a\u4e2a\u6570\u636e\ndb.students.updateMany({name: {$exists: true}}, {$set: {\"description\": \"school student\"} })\ndb.students.find({})\n[\n  {\n    _id: ObjectId('65d1ff0e76bc4fe476eabd1b'),\n    name: 'John',\n    age: 19,\n    description: 'school student'\n  },\n  {\n    _id: ObjectId('65d200a776bc4fe476eabd1e'),\n    name: 'lily',\n    age: 18,\n    description: 'school student'\n  },\n  {\n    _id: ObjectId('65d200a776bc4fe476eabd1f'),\n    name: 'Alen',\n    hobby: 'swim',\n    description: 'school student'\n  }\n]\n\n// \u91cd\u547d\u540d\u5b57\u6bb5\ndb.students.updateOne({name: 'lily'}, {$rename: {\"description\": \"desc\"} })\ndb.students.findOne({name: 'lily'})\n{\n  _id: ObjectId('65d200a776bc4fe476eabd1e'),\n  name: 'lily',\n  age: 18,\n  desc: 'school student'\n}\n\n// \u5220\u9664\u5b57\u6bb5\ndb.students.updateOne({name: 'Alen'}, {$unset: {\"hobby\": \"\"} })\ndb.students.findOne({name: 'Alen'})\n{\n  _id: ObjectId('65d200a776bc4fe476eabd1f'),\n  name: 'Alen',\n  description: 'school student Alen'\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u5220\u9664\u6570\u636e",children:"\u5220\u9664\u6570\u636e"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"deleteOne"}),"\n",(0,t.jsx)(e.li,{children:"deleteMany"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.code,{children:"db.coll.deleteMany(filter)"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"// \u5220\u9664\u5355\u4e2a\u6570\u636e\ndb.students.deleteOne({name: \"Alen\"})\ndb.students.find({})\n[\n  {\n    _id: ObjectId('65d1ff0e76bc4fe476eabd1b'),\n    name: 'John',\n    age: 19,\n    description: 'school student'\n  },\n  {\n    _id: ObjectId('65d200a776bc4fe476eabd1e'),\n    name: 'lily',\n    age: 18,\n    desc: 'school student'\n  }\n]\n\n// \u5220\u9664\u591a\u4e2a\u6570\u636e\ndb.students.deleteMany({})\n{ acknowledged: true, deletedCount: 2 }\ndb.students.find({})\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u5907\u4efd\u6062\u590d",children:"\u5907\u4efd\u6062\u590d"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"mongodump"}),"\n",(0,t.jsx)(e.li,{children:"mongorestore"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u5907\u4efd/\u6062\u590d mongo \u5168\u90e8\u6570\u636e\u5230 /data/db/mongo_backup \u8def\u5f84\u4e0b(\u6620\u5c04\u8def\u5f84, \u65b9\u4fbf\u53d6\u51fa)\n$ mongodump --out  /data/db/mongo_backup\n$ mongorestore  /data/db/mongo_backup\n\n# \u5907\u4efd\u548c\u6062\u590d\u6307\u5b9a\u6570\u636e\u5e93\u5230\u6307\u5b9a\u8def\u5f84\n$ mongodump --db database_name --out path\n$ mongorestore --db database_name --out path\n\n# \u5907\u4efd\u548c\u6062\u590d\u7279\u5b9a\u96c6\u5408\u5230\u6307\u5b9a\u8def\u5f84\n$ mongodump --db database_name --collection coll_name --out path\n$ mongorestore --db database_name --collection coll_name  --out path\n"})})]})}function b(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(r,{...n})}):r(n)}},8453:(n,e,d)=>{d.d(e,{R:()=>a,x:()=>l});var t=d(6540);const s={},o=t.createContext(s);function a(n){const e=t.useContext(o);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:a(n.components),t.createElement(o.Provider,{value:e},n.children)}}}]);