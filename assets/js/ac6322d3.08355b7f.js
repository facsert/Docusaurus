"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[5553],{8967:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>f,frontMatter:()=>l,metadata:()=>r,toc:()=>c});var i=t(4848),s=t(8453);const l={pubDatetime:new Date("2022-07-25T20:08:15.000Z"),title:"Python flat dictionary",slug:"Python flat dictionary",featured:!1,draft:!1,tags:["Python"],description:"Python \u6241\u5e73\u5316\u5b57\u5178"},a=void 0,r={id:"Python/python-flat-dict",title:"Python flat dictionary",description:"Python \u6241\u5e73\u5316\u5b57\u5178",source:"@site/docs/Python/python-flat-dict.md",sourceDirName:"Python",slug:"/Python/Python flat dictionary",permalink:"/docs/Python/Python flat dictionary",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Python/python-flat-dict.md",tags:[{inline:!0,label:"Python",permalink:"/docs/tags/python"}],version:"current",frontMatter:{pubDatetime:"2022-07-25T20:08:15.000Z",title:"Python flat dictionary",slug:"Python flat dictionary",featured:!1,draft:!1,tags:["Python"],description:"Python \u6241\u5e73\u5316\u5b57\u5178"},sidebar:"tutorialSidebar",previous:{title:"Python fastapi",permalink:"/docs/Python/Python fastapi"},next:{title:"Python loguru",permalink:"/docs/Python/Python loguru"}},d={},c=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"\u5f15\u7533",id:"\u5f15\u7533",level:2},{value:"\u5b57\u5178\u6241\u5e73\u5316",id:"\u5b57\u5178\u6241\u5e73\u5316",level:2},{value:"\u5b57\u5178\u5b58\u53d6",id:"\u5b57\u5178\u5b58\u53d6",level:2},{value:"\u5199\u5165",id:"\u5199\u5165",level:3},{value:"\u53d6\u51fa",id:"\u53d6\u51fa",level:3},{value:"\u5b9e\u73b0",id:"\u5b9e\u73b0",level:2}];function o(e){const n={br:"br",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,i.jsx)(n.h2,{id:"\u5f15\u7533",children:"\u5f15\u7533"}),"\n",(0,i.jsxs)(n.p,{children:["\u5b57\u5178\u7ecf\u5e38\u88ab\u7528\u6765\u5b58\u53d6\u6570\u636e, \u952e\u503c\u5bf9\u7684\u7ec4\u5408\u975e\u5e38\u4fbf\u4e8e\u4f7f\u7528",(0,i.jsx)(n.br,{}),"\n","\u4e00\u4e2a\u5b57\u5178\u53ef\u4ee5\u5b58\u50a8\u5927\u91cf\u6570\u636e, \u4e3a\u4e86\u4fbf\u4e8e\u533a\u5206\u8fd8\u53ef\u4ee5\u5c42\u5c42\u5206\u7ea7, \u591a\u5c42\u5d4c\u5957"]}),"\n",(0,i.jsxs)(n.p,{children:["\u5bf9\u4e8e\u591a\u5c42\u5b57\u5178\u5b58\u53d6\u6bd4\u8f83\u9ebb\u70e6",(0,i.jsx)(n.br,{}),"\n","\u63d2\u5165\u503c\u591a\u5c42\u7684\u6570\u636e\u7684\u65f6\u5019\u9700\u8981\u8003\u8651\u4e0a\u5c42\u662f\u5426\u5b58\u5728"]}),"\n",(0,i.jsxs)(n.p,{children:["\u80fd\u5426\u7b80\u5316\u6df1\u5c42\u5b57\u5178\u7684\u5b58\u53d6\u65b9\u5f0f",(0,i.jsx)(n.br,{}),"\n","\u63d2\u5165\u503c\u7684\u65f6\u5019\u80fd\u5426\u5ffd\u7565\u5c42\u7ea7\u95ee\u9898, \u81ea\u52a8\u751f\u6210\u591a\u7ea7\u6570\u636e"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5b57\u5178\u6241\u5e73\u5316",children:"\u5b57\u5178\u6241\u5e73\u5316"}),"\n",(0,i.jsxs)(n.p,{children:["\u5982\u4f55\u7b80\u5355\u5feb\u6377\u7684\u8fdb\u884c\u5feb\u901f\u5b58\u53d6\u6df1\u5c42\u5b57\u5178\u5462?",(0,i.jsx)(n.br,{}),"\n","\u80fd\u5426\u5c06\u5b57\u5178\u7b80\u5316\u6210\u5355\u5c42\u7ed3\u6784, \u5b57\u5178\u5185\u5c31\u662f key \u548c value"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def flat_dict(dic):\n    for key, value in dic.items():\n        if isinstance(value, dict):\n            for k, v in flat_dict(value):\n                k = '{key}.{k}'.format(key=key, k=k)\n                yield (k, v)\n        else:\n            yield (key, value)\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"if __name__ == '__main__':\n    depth_dict = {'a':{'b': {'c': 0}, 'd':1}, 'c': 1}\n    print(dict(flat_dict(depth_dict)))\n\n>>> {'a.b.c': 0, 'a.d': 1, 'c': 1}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u901a\u8fc7\u9012\u5f52\u5faa\u73af\u904d\u5386\u6df1\u5c42\u5b57\u5178, \u628a\u591a\u5c42 key \u901a\u8fc7\u5206\u9694\u7b26\u8fde\u63a5",(0,i.jsx)(n.br,{}),"\n","\u4f46\u662f, \u8fd9\u6837\u6241\u5e73\u5316\u65e0\u6cd5\u83b7\u53d6\u5b57\u5178\u7c7b\u578b\u7684 value"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def flat_dict(dic):\n    for key, value in dic.items():\n        yield (key, value)\n        if isinstance(value, dict):\n            for k, v in flat_dict(value):\n                k = '{key}.{k}'.format(key=key, k=k)\n                yield (k, v)\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"if __name__ == '__main__':\n    depth_dict = {'a':{'b': {'c': 0}, 'd':1}, 'c': 1}\n    print(dict(flat_dict(depth_dict)))\n\n>>> {'a': {'b': {'c': 0}, 'd': 1}, 'a.b': {'c': 0}, 'a.b.c': 0, 'a.d': 1, 'c': 1}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u589e\u52a0\u4e86\u5b57\u5178\u5bb9\u91cf, \u4f46\u662f\u4fdd\u5b58\u4e86\u6240\u6709 key \u7684\u503c"}),"\n",(0,i.jsx)(n.h2,{id:"\u5b57\u5178\u5b58\u53d6",children:"\u5b57\u5178\u5b58\u53d6"}),"\n",(0,i.jsxs)(n.p,{children:["\u80fd\u5c06\u5b57\u5178\u6241\u5e73\u5316\u540e, \u8003\u8651\u5982\u4f55\u5b58\u53d6",(0,i.jsx)(n.br,{}),"\n","\u9b54\u6539\u9b54\u672f\u65b9\u6cd5 ",(0,i.jsx)(n.code,{children:"setitem"})," \u548c ",(0,i.jsx)(n.code,{children:"getitem"})," \u901a\u8fc7 [] \u5b58\u53d6\u6570\u636e"]}),"\n",(0,i.jsx)(n.p,{children:"\u4fdd\u7559\u5b57\u5178\u539f\u6709\u5c5e\u6027\u548c\u65b9\u6cd5, \u65b0\u6570\u636e\u7c7b\u578b\u7ee7\u627f\u5b57\u5178\u7c7b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"\nclass Flat(dict):\n\n    def __init__(self, depth):\n        dict.__init__(self, depth)\n        self.flat = OrderedDict()\n        self.char_split = '.'\n\n    def flat_dict(self):\n        pass\n\n    def update_dict(self, key, value):\n        pass\n\n    def __setitem__(self, key, value):\n        pass\n\n    def __getitem__(self, key):\n        pass\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u5199\u5165",children:"\u5199\u5165"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u89e3\u6790\u6241\u5e73\u5316 key \u751f\u6210\u6df1\u5ea6\u5b57\u5178, \u4e14\u66f4\u65b0\u5230\u6df1\u5ea6\u5b57\u5178"}),"\n",(0,i.jsx)(n.li,{children:"\u628a\u6570\u636e\u5199\u5165\u6df1\u5ea6\u5b57\u5178\u548c\u6241\u5e73\u5316\u5b57\u5178"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"    def __setitem__(self, key, value):\n        self.update_dict(key, value)\n\n    def update_dict(self, key, value):\n        key_list = key.split(self.char_split)\n        first, last = key_list[0], key_list[-1]\n\n        dic = self\n        for k in key_list[:-1]:\n            dic.setdefault(k, {})\n            if not isinstance(dic[k], dict):\n                dic.update({k: {}})\n            dic = dic[k]\n\n        dic.update({last: value})\n        self.flat.update(self.flat_dict({first: self[first]}))\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u53d6\u51fa",children:"\u53d6\u51fa"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"    def __getitem__(self, key):\n        try:\n            return dict.__getitem__(self, key)\n        except KeyError:\n            return self.flat[key]\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u5b9e\u73b0",children:"\u5b9e\u73b0"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"__str__"})," \u80fd\u76f4\u63a5\u683c\u5f0f\u5316\u6253\u5370\u7ed3\u679c\n\u6dfb\u52a0\u81ea\u5b9a\u4e49\u5206\u9694\u7b26"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class FlatDict(dict):\n    \"\"\"\u6241\u5e73\u5316\u5b57\u5178\"\"\"\n\n    def __init__(self, *args, **kwargs):\n        '''\n        Description: \u521d\u59cb\u5316\u5c5e\u6027, flat(\u6241\u5e73\u5316\u5b57\u5178) separator(\u5206\u9694\u7b26)\n        Return: None\n        Attention: \u5bf9\u8c61\u5b58\u4e00\u4e2a\u539f\u751f\u5b57\u5178\u548c\u6241\u5e73\u5316\u5b57\u5178\n        '''\n        super().__init__(*args, **kwargs)\n        super().update(*args, **kwargs)\n        self.flat = {}\n        self.separator = \".\"\n        self.flat_dict(self)\n\n    def update_dict(self, key, value):\n        '''\n        Description: \u89e3\u6790 key, \u5c06\u591a\u5c42 key \u9010\u5c42\u89e3\u6790\u5199\u5165\u539f\u751f\u5b57\u5178\n        Param key str: \u5b57\u5178 key, \u591a\u5c42 key \u5305\u542b\u5206\u9694\u7b26\n        Param value Any: \u5b57\u5178 value\n        Return: None\n        Attention:\n        '''\n        dic = self\n        keys = key.split(self.separator)\n        for k in keys[:-1]:\n            dic.setdefault(k, {})\n            if not isinstance(dic[k], dict):\n                dic.update({k: {}})\n            dic = dic[k]\n\n        dic[keys[-1]] = value\n        self.flat_dict(self)\n\n    def flat_dict(self, dic, parent_key=''):\n        '''\n        Description: \u539f\u751f\u5b57\u5178\u591a\u5c42 key \u901a\u8fc7\u5206\u9694\u7b26\u8fde\u63a5\u5199\u5165 flat \u5b57\u5178\n        Param dic dict: \u539f\u751f\u5b57\u5178\n        Param parent_key dict: \u7236\u5b57\u5178\u7684 key\n        Return: None\n        Attention: \u4efb\u4e00\u5c42\u7684\u5b57\u5178 key value \u90fd\u8981\u4fdd\u5b58\n        '''\n        for key, value in dic.items():\n            new_key = f\"{parent_key}{self.separator}{key}\" if parent_key else key\n            self.flat[new_key] = value\n            if isinstance(value, dict):\n                self.flat_dict(value, new_key)\n\n    def __setitem__(self, key, value):\n        '''\n        Description: \u5b57\u5178 [] \u65b9\u5f0f\u8bbe\u7f6e\u503c\n        Param key str: \u539f\u751f\u5b57\u5178\n        Param value Any: \u7236\u5b57\u5178\u7684 key\n        Return: None\n        Attention:\n        '''\n        if self.separator in key:\n            self.update_dict(key, value)\n        else:\n            super().__setitem__(key, value)\n\n    def __getitem__(self, key):\n        '''\n        Description: \u5b57\u5178 [] \u83b7\u53d6\u503c\n        Param key str: \u5b57\u5178 key, \u5141\u8bb8\u4f7f\u7528\u591a\u5c42 key\n        Return Any: \u5b57\u5178 key \u5bf9\u5e94\u7684 value\n        Attention:\n        '''\n        try:\n            return super().__getitem__(key)\n        except KeyError:\n            return self.flat[key]\n\n    def __delitem__(self, key):\n        '''\n        Description: \u5b57\u5178\u5220\u9664 key-value\n        Param key str: \u5b57\u5178 key, \u4e0d\u5141\u8bb8\u4f7f\u7528\u591a\u5c42 key\n        Return: None\n        Attention: \u53ea\u5141\u8bb8\u4f7f\u7528\u539f\u751f\u5b57\u5178\u7684 key\n        '''\n        super().__delitem__(key)\n        self.flat = {}\n        self.flat_dict(self)\n\n    def __len__(self):\n        '''\n        Description: \u83b7\u53d6\u539f\u751f\u5b57\u5178\u957f\u5ea6\n        Return int: \u5b57\u5178\u957f\u5ea6\n        Attention:\n        '''\n        return super().__len__()\n\n    def update(self, *args, **kwargs):\n        '''\n        Description: \u66f4\u65b0\u5b57\u5178\n        Return: None\n        Attention: \u7528\u6cd5\u4e0e\u539f\u751f\u5b57\u5178\u4e00\u81f4\n        '''\n        super().update(*args, **kwargs)\n        self.flat = {}\n        self.flat_dict(self)\n\n    def get(self, key, default=None):\n        '''\n        Description: \u6241\u5e73\u5b57\u5178 get \u65b9\u6cd5\n        '''\n        return self.flat.get(key, default)\n\n    def __str__(self):\n        '''\n        Description: json \u683c\u5f0f\u539f\u751f\u5b57\u5178\n        Return srt: \u5b57\u5178\u5b57\u7b26\u4e32\n        Attention:\n        '''\n        return dumps(self, indent=4)\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'flat = Flat()\nflat[\'a.b.c\'] = 1\nflat[\'b.c.a\'] = 2\nprint(flat[\'a.b\'])\nprint(flat[\'b.c.a\'])\nprint(flat)\n\n\n{\'c\': 1}\n2\n{\n    "a": {\n        "b": {\n            "c": 1\n        }\n    },\n    "b": {\n        "c": {\n            "a": 2\n        }\n    }\n}\n'})})]})}function f(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var i=t(6540);const s={},l=i.createContext(s);function a(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);